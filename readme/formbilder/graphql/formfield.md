# FormField

### Описание полей

| Поле                 | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| name                 | имя поля, для указания в мутации                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| required             | обязательность поля                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| title                | заголовок поля для пользователя                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| type                 | <p>тип поля. Имеет одно из следующих значений</p><ul><li>TEXT - input типа 'text'</li><li>TEXTAREA - тег textarea</li><li>CHECKBOX - input типа 'checkbox'</li><li>SELECT - input типа 'select'</li><li>RADIO - input типа 'radio'</li><li>MULTISELECT - input типа 'select' с возможностью множественного выбора</li><li>MULTICHECKBOX - input с возможностью множественного выбора, отображается, как набор чекбоксов</li><li>INT - input допускающий целые числа</li><li>FLOAT - input допускающий дробные числа</li><li>DATETIME - input с указанием даты и времени</li><li>PHONE - input для с форматированием телефонных номеров</li><li>GALLERY - поле для загрузки фотографий</li><li>MAP_ACCESSOR - поле группы типа MAP_PARAMS. Отображается как чекбокс и позволяет пользователю проставлять метку на карте</li><li>MAP_LATITUDE - поле группы типа MAP_PARAMS. Широта координаты</li><li>MAP_LONGITUDE - поле группы типа MAP_PARAMS. Долгота координаты.</li><li>MAP_ZOOM - поле группы типа MAP_PARAMS. Устанавливает приближение карты.</li><li>INPUT_ADDRESS_DADATA_SEARCH - специальное поле для поиска адреса по dadata. При заполнении отправляет запрос по api на сервис dadata ("<a href="https://suggestions.dadata.ru/suggestions">https://suggestions.dadata.ru/suggestions</a>"), полученный ответ отображает как список найденных адресов. При выборе пользователем варианта, триггерится зависимость как будто в поле проставили значение. В качестве значения выступает json объект указанного варианта. Обычно согласно установленным зависимостям идёт запрос на перезагрузку полей, относящимся к адресу</li><li>HIDDEN - скрытое от пользователя поле</li><li>SINGLE_CHOICE_TILES - поле типа select, однако стилистически выглядит как плитки со значениями.</li><li>TOGGLE - поле типа checkbox, однако стилистически выглядит как toggle</li><li>YEAR - поля для указания года.</li></ul> |
| value                | текущее значение указанного поля. Все значения выводятся в виде строки. Фактический типа данных смотреть в поле **inputType**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| listOptions          | список объектов типа _ListOption_, содержащие поля name и value. Используется в связке с типами полей SELECT, MULTISELECT, MULTICHECKBOX, SINGLE\_CHOICE\_TILES для вывода списка возможных опций выбора.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| suffix               | суффикс к указанному полю. Обычно используется в качестве указания метрики значения                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| placeholder          | placeholder аттрибут поля                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| listValues           | поле, для типов имеющих множественное значение (MULTICHECKBOX, MULTISELECT). Содержит проставленные значения опций из **listOptions**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| fieldDependencyList  | поле для указания зависимостей/способов взаимодействия между полями формы.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| groupName            | название родительской группы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| inputType            | тип поля в понимании graphQl. Полезно для приведения данных к определённому типу при отправке их в мутации, когда это не всегда однозначно. Например, для поля MULTISELECT, SELECT значения могут быть как числом (\*\* inputType\*\*="\[Int]" для MULTISELECT, **inputType**="Int" для SELECT), так и строкой(**inputType**="\[String]" для MULTISELECT, **inputType**="String" для SELECT).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### Работа зависимостей (_FieldsDependencyDescriber_)

В форме иногда возникает потребность в определении зависимостей между полями. Например, у формы есть 3 поля описывающих адрес объекта: регион, административный центр и населённый пункт. Все эти 3 поля - select'ы с выбором значения из выпадающего списка. Задача: сделать так, чтобы при выборе региона список опций административного центра сужался до предназначенных этому региону. То же самое происходит и для населённых пунктов при выборе административного центра - пользователь может выбрать населённый пункт только принадлежащий выбранному административному центру.

Для определения таких зависимостей между полями используется поле **fieldDependencyList** (тип \* FieldsDependencyDescriber\*) в _FormField_. Тип _FieldsDependencyDescriber_ включает в себя 3 поля:

* **fieldNames** - список полей, которые нужно будет запросить при триггере зависимости. Если список пустой, значит в качестве запрашиваемого поля должно быть поле, в котором объявлена зависимость (Иными словами поле вызывает само себя)
* **dependencyType** - тип зависимости, определяет условия срабатывания зависимости. Может принимать следующие значения:
  * RELOAD\_TARGET\_ELEMENT - зависимость, при которой указанные в **fieldNames** поля запрашиваются при изменении значения у поля, в котором текущая зависимость объявлена.
  * HIDE\_TARGET\_ON\_CHECKED - зависимость, при которой указанные поля скрываются от пользователя (а значения приводятся к null при мутации), при проставлении значения true
  * SHOW\_TARGET\_ON\_CHECKED - обратное к HIDE\_TARGET\_ON\_CHECKED поведение
  * LOAD\_EXTENDED\_AFTER\_FORM - зависимость, которая срабатывает после прогрузки всей формы. Для случаев, когда поле грузит тяжелые данные долго и лучше их прогрузить фоном дополнительным запросом.
* **additionalInfluencingFields** - список полей, которые нужно указать вдобавок к текущему в **dependentFields** (\* DependentFieldValueInput\*) в запросе. Иногда значения одного поля недостаточно, чтобы разрешить зависимость. Например, в интерактивной карте должны меняться координаты метки в зависимости от значений в полях "регион", "административный центр" и "населённый пункт". Если пользователь поменяет значение в поле населённый пункт, то по логике мы запросим поля "широта", "долгота" и "zoom" и укажем значение текущего поля ("населённый пункт"), однако одного населённого пункта недостаточно для определения координат, нужно так же собрать данные и с полей "регион" и "административный центр", хотя пользователь поменял значение только в "населённом пункте"

Для всех форм должен быть дополнительный query, в котором можно запросить отдельное поле и разрешить зависимость ( например _**settlement\_form\_elements**_). В отличие от запросов ко всей форме (например _**settlement\_form**_), запросы к отдельным элементам формы игнорируют структуру и в ответе выдают только запрошенные элементы.
